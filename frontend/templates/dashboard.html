<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Guardian LLM</title>
    <meta name="description" content="Guardian LLM Dashboard - Monitor ethical risk assessments, system performance, and analytics">
    <meta name="author" content="Prashish Shrestha">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- Custom Styles -->
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-color: #dee2e6;
            --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-medium: 0 4px 20px rgba(0,0,0,0.15);
            --shadow-heavy: 0 8px 30px rgba(0,0,0,0.2);
            --border-radius: 12px;
            --transition: all 0.3s ease;
            --sidebar-width: 280px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background: var(--light-color);
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            z-index: 1000;
            transition: var(--transition);
            overflow-y: auto;
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar-header {
            padding: 30px 25px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        .sidebar.collapsed .sidebar-header {
            padding: 20px 10px;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
            transition: var(--transition);
        }

        .sidebar.collapsed .logo {
            font-size: 1.2rem;
        }

        .logo-subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
            transition: var(--transition);
        }

        .sidebar.collapsed .logo-subtitle {
            display: none;
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-item {
            margin: 5px 15px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition);
            position: relative;
        }

        .sidebar.collapsed .nav-link {
            justify-content: center;
            padding: 15px 10px;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            transform: translateX(5px);
        }

        .sidebar.collapsed .nav-link:hover {
            transform: none;
        }

        .nav-link.active {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .nav-icon {
            font-size: 1.2rem;
            margin-right: 15px;
            min-width: 20px;
        }

        .sidebar.collapsed .nav-icon {
            margin-right: 0;
        }

        .nav-text {
            transition: var(--transition);
        }

        .sidebar.collapsed .nav-text {
            display: none;
        }

        .nav-badge {
            background: var(--danger-color);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
        }

        .sidebar.collapsed .nav-badge {
            display: none;
        }

        .sidebar-toggle {
            position: absolute;
            top: 20px;
            right: -15px;
            background: white;
            color: var(--primary-color);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }

        .sidebar-toggle:hover {
            transform: scale(1.1);
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
            background: var(--light-color);
            transition: var(--transition);
        }

        .sidebar.collapsed + .main-content {
            margin-left: 80px;
        }

        /* Header */
        .header {
            background: white;
            padding: 20px 30px;
            box-shadow: var(--shadow-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Dashboard Content */
        .dashboard-content {
            padding: 30px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .metric-card.primary::before { background: var(--primary-color); }
        .metric-card.success::before { background: var(--success-color); }
        .metric-card.warning::before { background: var(--warning-color); }
        .metric-card.danger::before { background: var(--danger-color); }
        .metric-card.info::before { background: var(--info-color); }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .metric-title {
            font-size: 0.9rem;
            color: #6c757d;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-icon {
            font-size: 1.5rem;
            opacity: 0.7;
        }

        .metric-icon.primary { color: var(--primary-color); }
        .metric-icon.success { color: var(--success-color); }
        .metric-icon.warning { color: var(--warning-color); }
        .metric-icon.danger { color: var(--danger-color); }
        .metric-icon.info { color: var(--info-color); }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .metric-change {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .metric-change.positive {
            color: var(--success-color);
        }

        .metric-change.negative {
            color: var(--danger-color);
        }

        .metric-change.neutral {
            color: #6c757d;
        }

        /* Chart Cards */
        .chart-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
            margin-bottom: 25px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .chart-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chart-select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: white;
            color: var(--dark-color);
            font-size: 0.9rem;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }

        .chart-container.small {
            height: 250px;
        }

        /* Data Table */
        .data-table {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .table-header {
            background: var(--light-color);
            padding: 20px 25px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .table-search {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: white;
            font-size: 0.9rem;
            width: 250px;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--light-color);
            font-weight: 600;
            color: var(--dark-color);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            color: #495057;
        }

        tr:hover {
            background: rgba(102, 126, 234, 0.02);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge.low {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }

        .status-badge.medium {
            background: rgba(255, 193, 7, 0.1);
            color: #e67e22;
        }

        .status-badge.high {
            background: rgba(253, 126, 20, 0.1);
            color: #fd7e14;
        }

        .status-badge.critical {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        /* Risk Distribution */
        .risk-distribution {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .risk-category-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .risk-category-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .category-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .category-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 8px;
        }

        .category-score {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .category-score.low { color: var(--success-color); }
        .category-score.medium { color: var(--warning-color); }
        .category-score.high { color: #fd7e14; }
        .category-score.critical { color: var(--danger-color); }

        .category-trend {
            font-size: 0.8rem;
            color: #6c757d;
        }

        /* System Health */
        .health-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .health-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
        }

        .health-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .health-status.healthy { background: var(--success-color); }
        .health-status.warning { background: var(--warning-color); }
        .health-status.error { background: var(--danger-color); }

        .health-label {
            font-size: 0.9rem;
            color: var(--dark-color);
            font-weight: 500;
        }

        /* Loading States */
        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 4px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-text {
            height: 20px;
            margin: 8px 0;
        }

        .skeleton-number {
            height: 40px;
            width: 80px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-toggle {
                display: block;
            }

            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
            }

            .header-title {
                font-size: 1.5rem;
            }

            .dashboard-content {
                padding: 20px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .chart-container {
                height: 300px;
            }

            .table-search {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .search-input {
                width: 100%;
            }
        }

        /* Dark Theme Support */
        @media (prefers-color-scheme: dark) {
            :root {
                --light-color: #1a1a1a;
                --dark-color: #ffffff;
                --border-color: #333333;
            }

            body {
                background: #1a1a1a;
                color: #ffffff;
            }

            .metric-card,
            .chart-card,
            .data-table,
            .risk-category-card,
            .health-indicator {
                background: #2d2d2d;
                border-color: #404040;
            }

            .header {
                background: #2d2d2d;
                border-bottom: 1px solid #404040;
            }

            th {
                background: #404040;
            }

            .search-input,
            .chart-select {
                background: #2d2d2d;
                border-color: #404040;
                color: #ffffff;
            }
        }

        /* Print Styles */
        @media print {
            .sidebar,
            .sidebar-toggle,
            .header-actions,
            .mobile-toggle {
                display: none;
            }

            .main-content {
                margin-left: 0;
            }

            .chart-card,
            .metric-card,
            .data-table {
                break-inside: avoid;
                margin-bottom: 20px;
            }
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <button class="sidebar-toggle" onclick="toggleSidebar()">
            <i class="fas fa-chevron-left" id="toggleIcon"></i>
        </button>

        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                <span class="logo-text">Guardian LLM</span>
            </div>
            <div class="logo-subtitle">Ethical Risk Dashboard</div>
        </div>

        <div class="sidebar-nav">
            <div class="nav-item">
                <a href="#overview" class="nav-link active" data-section="overview">
                    <i class="fas fa-tachometer-alt nav-icon"></i>
                    <span class="nav-text">Overview</span>
                </a>
            </div>

            <div class="nav-item">
                <a href="#analytics" class="nav-link" data-section="analytics">
                    <i class="fas fa-chart-line nav-icon"></i>
                    <span class="nav-text">Analytics</span>
                </a>
            </div>

            <div class="nav-item">
                <a href="#papers" class="nav-link" data-section="papers">
                    <i class="fas fa-file-alt nav-icon"></i>
                    <span class="nav-text">Papers</span>
                    <span class="nav-badge" id="papersBadge">0</span>
                </a>
            </div>

            <div class="nav-item">
                <a href="#risks" class="nav-link" data-section="risks">
                    <i class="fas fa-exclamation-triangle nav-icon"></i>
                    <span class="nav-text">Risk Analysis</span>
                </a>
            </div>

            <div class="nav-item">
                <a href="#system" class="nav-link" data-section="system">
                    <i class="fas fa-cogs nav-icon"></i>
                    <span class="nav-text">System Health</span>
                </a>
            </div>

            <div class="nav-item">
                <a href="#reports" class="nav-link" data-section="reports">
                    <i class="fas fa-file-download nav-icon"></i>
                    <span class="nav-text">Reports</span>
                </a>
            </div>

            <div class="nav-item" style="margin-top: 30px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;">
                <a href="/" class="nav-link">
                    <i class="fas fa-arrow-left nav-icon"></i>
                    <span class="nav-text">Back to Analyzer</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="mobile-toggle btn-outline" onclick="toggleSidebar()" style="display: none;">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="header-title" id="pageTitle">Dashboard Overview</h1>
            </div>

            <div class="header-actions">
                <select class="chart-select" id="timeRange" onchange="updateTimeRange()">
                    <option value="24h">Last 24 Hours</option>
                    <option value="7d" selected>Last 7 Days</option>
                    <option value="30d">Last 30 Days</option>
                    <option value="90d">Last 90 Days</option>
                </select>

                <button class="btn btn-outline" onclick="refreshDashboard()">
                    <i class="fas fa-refresh"></i>
                    Refresh
                </button>

                <a href="/" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    New Analysis
                </a>
            </div>
        </header>

        <!-- Dashboard Content -->
        <div class="dashboard-content">
            <!-- Overview Section -->
            <section id="overview-section" class="dashboard-section active">
                <!-- Key Metrics -->
                <div class="dashboard-grid">
                    <div class="metric-card primary">
                        <div class="metric-header">
                            <div class="metric-title">Total Papers</div>
                            <i class="fas fa-file-alt metric-icon primary"></i>
                        </div>
                        <div class="metric-value" id="totalPapersMetric">
                            <div class="loading-skeleton skeleton-number"></div>
                        </div>
                        <div class="metric-change neutral" id="totalPapersChange">
                            <i class="fas fa-minus"></i>
                            No change
                        </div>
                    </div>

                    <div class="metric-card danger">
                        <div class="metric-header">
                            <div class="metric-title">High Risk Papers</div>
                            <i class="fas fa-exclamation-triangle metric-icon danger"></i>
                        </div>
                        <div class="metric-value" id="highRiskMetric">
                            <div class="loading-skeleton skeleton-number"></div>
                        </div>
                        <div class="metric-change negative" id="highRiskChange">
                            <i class="fas fa-arrow-up"></i>
                            +5 this week
                        </div>
                    </div>

                    <div class="metric-card success">
                        <div class="metric-header">
                            <div class="metric-title">Avg Processing Time</div>
                            <i class="fas fa-clock metric-icon success"></i>
                        </div>
                        <div class="metric-value" id="avgTimeMetric">
                            <div class="loading-skeleton skeleton-number"></div>
                        </div>
                        <div class="metric-change positive" id="avgTimeChange">
                            <i class="fas fa-arrow-down"></i>
                            -2.3s faster
                        </div>
                    </div>

                    <div class="metric-card info">
                        <div class="metric-header">
                            <div class="metric-title">System Accuracy</div>
                            <i class="fas fa-percentage metric-icon info"></i>
                        </div>
                        <div class="metric-value" id="accuracyMetric">99.7%</div>
                        <div class="metric-change positive">
                            <i class="fas fa-arrow-up"></i>
                            +0.2% improved
                        </div>
                    </div>
                </div>

                <!-- Risk Distribution Overview -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h2 class="chart-title">Risk Category Distribution</h2>
                        <div class="chart-controls">
                            <select class="chart-select" id="riskChartType">
                                <option value="average">Average Scores</option>
                                <option value="count">Paper Count</option>
                                <option value="trend">Trend Analysis</option>
                            </select>
                        </div>
                    </div>
                    <div class="risk-distribution" id="riskDistribution">
                        <!-- Risk category cards will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Analysis Trends Chart -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h2 class="chart-title">Analysis Trends</h2>
                        <div class="chart-controls">
                            <select class="chart-select" id="trendMetric">
                                <option value="papers">Papers Analyzed</option>
                                <option value="risk_scores">Average Risk Scores</option>
                                <option value="processing_time">Processing Time</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="trendsChart"></canvas>
                    </div>
                </div>

                <!-- Recent Papers Summary -->
                <div class="data-table">
                    <div class="table-header">
                        <h2 class="table-title">Recent Analyses</h2>
                        <div class="table-search">
                            <input type="text" class="search-input" placeholder="Search papers..." id="paperSearch">
                            <button class="btn btn-outline btn-sm">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="recentPapersTable">
                            <thead>
                                <tr>
                                    <th>Paper Title</th>
                                    <th>Upload Date</th>
                                    <th>Overall Score</th>
                                    <th>Risk Level</th>
                                    <th>Processing Time</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentPapersBody">
                                <!-- Table rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics-section" class="dashboard-section" style="display: none;">
                <h2 style="margin-bottom: 30px; color: var(--dark-color);">
                    <i


                    <section id="analytics-section" class="dashboard-section" style="display: none;">
                <h2 style="margin-bottom: 30px; color: var(--dark-color);">
                    <i class="fas fa-chart-line"></i> Advanced Analytics
                </h2>

                <!-- Performance Metrics Grid -->
                <div class="dashboard-grid">
                    <div class="metric-card warning">
                        <div class="metric-header">
                            <div class="metric-title">Peak Analysis Time</div>
                            <i class="fas fa-chart-area metric-icon warning"></i>
                        </div>
                        <div class="metric-value" id="peakAnalysisTime">--</div>
                        <div class="metric-change neutral">
                            <span id="peakTimeDetails">Loading...</span>
                        </div>
                    </div>

                    <div class="metric-card info">
                        <div class="metric-header">
                            <div class="metric-title">Most Common Risk</div>
                            <i class="fas fa-trophy metric-icon info"></i>
                        </div>
                        <div class="metric-value" id="commonRiskType" style="font-size: 1.2rem;">--</div>
                        <div class="metric-change neutral">
                            <span id="commonRiskPercent">--% of papers</span>
                        </div>
                    </div>

                    <div class="metric-card success">
                        <div class="metric-header">
                            <div class="metric-title">Success Rate</div>
                            <i class="fas fa-check-circle metric-icon success"></i>
                        </div>
                        <div class="metric-value" id="successRate">--</div>
                        <div class="metric-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="successRateChange">Stable</span>
                        </div>
                    </div>

                    <div class="metric-card primary">
                        <div class="metric-header">
                            <div class="metric-title">Avg Confidence</div>
                            <i class="fas fa-brain metric-icon primary"></i>
                        </div>
                        <div class="metric-value" id="avgConfidence">--</div>
                        <div class="metric-change positive">
                            <span id="confidenceChange">High reliability</span>
                        </div>
                    </div>
                </div>

                <!-- Detailed Charts Row -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px;">
                    <!-- Risk Score Distribution -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Risk Score Distribution</h3>
                            <div class="chart-controls">
                                <select class="chart-select" id="distributionPeriod">
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                    <option value="quarter">This Quarter</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-container small">
                            <canvas id="riskDistributionChart"></canvas>
                        </div>
                    </div>

                    <!-- Processing Time Trends -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Processing Performance</h3>
                            <div class="chart-controls">
                                <select class="chart-select" id="performanceMetric">
                                    <option value="time">Processing Time</option>
                                    <option value="throughput">Throughput</option>
                                    <option value="accuracy">Accuracy Rate</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-container small">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Category Analysis Heatmap -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Risk Category Correlation Matrix</h3>
                        <div class="chart-controls">
                            <button class="btn btn-outline btn-sm" onclick="exportHeatmapData()">
                                <i class="fas fa-download"></i> Export Data
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="correlationMatrix"></canvas>
                    </div>
                </div>

                <!-- Detailed Analytics Table -->
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Category Performance Analytics</h3>
                        <div class="table-search">
                            <select class="chart-select" id="categoryFilter">
                                <option value="all">All Categories</option>
                                <option value="bias_fairness">Bias & Fairness</option>
                                <option value="privacy_data">Privacy & Data</option>
                                <option value="safety_security">Safety & Security</option>
                                <option value="dual_use">Dual-Use</option>
                                <option value="societal_impact">Societal Impact</option>
                                <option value="transparency">Transparency</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="categoryAnalyticsTable">
                            <thead>
                                <tr>
                                    <th>Risk Category</th>
                                    <th>Avg Score</th>
                                    <th>Papers Analyzed</th>
                                    <th>High Risk %</th>
                                    <th>Avg Confidence</th>
                                    <th>Trend</th>
                                </tr>
                            </thead>
                            <tbody id="categoryAnalyticsBody">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Papers Section -->
            <section id="papers-section" class="dashboard-section" style="display: none;">
                <h2 style="margin-bottom: 30px; color: var(--dark-color);">
                    <i class="fas fa-file-alt"></i> Paper Management
                </h2>

                <!-- Papers Filter Controls -->
                <div class="chart-card" style="padding: 20px; margin-bottom: 25px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; align-items: end;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500; color: var(--dark-color);">Filter by Risk Level</label>
                            <select class="chart-select" id="riskLevelFilter" style="width: 100%;">
                                <option value="all">All Risk Levels</option>
                                <option value="low">Low Risk (0-2.5)</option>
                                <option value="medium">Medium Risk (2.5-5.0)</option>
                                <option value="high">High Risk (5.0-7.5)</option>
                                <option value="critical">Critical Risk (7.5-10)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500; color: var(--dark-color);">Date Range</label>
                            <select class="chart-select" id="dateRangeFilter" style="width: 100%;">
                                <option value="all">All Time</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="quarter">This Quarter</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500; color: var(--dark-color);">Sort By</label>
                            <select class="chart-select" id="sortFilter" style="width: 100%;">
                                <option value="date_desc">Newest First</option>
                                <option value="date_asc">Oldest First</option>
                                <option value="risk_desc">Highest Risk</option>
                                <option value="risk_asc">Lowest Risk</option>
                                <option value="title_asc">Title A-Z</option>
                            </select>
                        </div>
                        
                        <div>
                            <button class="btn btn-primary" onclick="applyPapersFilter()" style="width: 100%;">
                                <i class="fas fa-filter"></i> Apply Filters
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Papers Data Table -->
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">All Analyzed Papers</h3>
                        <div class="table-search">
                            <input type="text" class="search-input" placeholder="Search by title, author, or content..." id="papersSearchInput">
                            <button class="btn btn-outline btn-sm" onclick="searchPapers()">
                                <i class="fas fa-search"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="exportPapersData()">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="allPapersTable">
                            <thead>
                                <tr>
                                    <th style="width: 40%;">Paper Details</th>
                                    <th>Risk Score</th>
                                    <th>Categories</th>
                                    <th>Upload Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="allPapersBody">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <div style="padding: 20px; border-top: 1px solid var(--border-color); display: flex; justify-content: between; align-items: center;">
                        <div style="color: #6c757d; font-size: 0.9rem;" id="paginationInfo">
                            Showing 1-10 of 0 papers
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-outline btn-sm" id="prevPageBtn" onclick="changePage(-1)" disabled>
                                <i class="fas fa-chevron-left"></i> Previous
                            </button>
                            <button class="btn btn-outline btn-sm" id="nextPageBtn" onclick="changePage(1)" disabled>
                                Next <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Risk Analysis Section -->
            <section id="risks-section" class="dashboard-section" style="display: none;">
                <h2 style="margin-bottom: 30px; color: var(--dark-color);">
                    <i class="fas fa-exclamation-triangle"></i> Risk Analysis Dashboard
                </h2>

                <!-- Risk Summary Cards -->
                <div class="dashboard-grid">
                    <div class="metric-card critical">
                        <div class="metric-header">
                            <div class="metric-title">Critical Risks</div>
                            <i class="fas fa-exclamation-circle metric-icon danger"></i>
                        </div>
                        <div class="metric-value" id="criticalRisksCount">--</div>
                        <div class="metric-change negative">
                            <span id="criticalRisksTrend">Requires immediate attention</span>
                        </div>
                    </div>

                    <div class="metric-card warning">
                        <div class="metric-header">
                            <div class="metric-title">High Risks</div>
                            <i class="fas fa-exclamation-triangle metric-icon warning"></i>
                        </div>
                        <div class="metric-value" id="highRisksCount">--</div>
                        <div class="metric-change neutral">
                            <span id="highRisksTrend">Monitor closely</span>
                        </div>
                    </div>

                    <div class="metric-card info">
                        <div class="metric-header">
                            <div class="metric-title">Most Frequent Risk</div>
                            <i class="fas fa-chart-bar metric-icon info"></i>
                        </div>
                        <div class="metric-value" id="frequentRiskType" style="font-size: 1rem;">--</div>
                        <div class="metric-change neutral">
                            <span id="frequentRiskCount">-- occurrences</span>
                        </div>
                    </div>

                    <div class="metric-card success">
                        <div class="metric-header">
                            <div class="metric-title">Low Risk Papers</div>
                            <i class="fas fa-check-circle metric-icon success"></i>
                        </div>
                        <div class="metric-value" id="lowRisksCount">--</div>
                        <div class="metric-change positive">
                            <span id="lowRisksPercent">--% of total</span>
                        </div>
                    </div>
                </div>

                <!-- Risk Category Detailed Analysis -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Risk Category Deep Dive</h3>
                        <div class="chart-controls">
                            <select class="chart-select" id="riskCategorySelect">
                                <option value="all">All Categories</option>
                                <option value="bias_fairness">Bias & Fairness</option>
                                <option value="privacy_data">Privacy & Data</option>
                                <option value="safety_security">Safety & Security</option>
                                <option value="dual_use">Dual-Use</option>
                                <option value="societal_impact">Societal Impact</option>
                                <option value="transparency">Transparency</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="risk-distribution" id="detailedRiskAnalysis">
                        <!-- Detailed risk cards populated by JavaScript -->
                    </div>
                </div>

                <!-- Risk Trends Over Time -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Risk Trends Over Time</h3>
                        <div class="chart-controls">
                            <select class="chart-select" id="riskTrendPeriod">
                                <option value="7d">Last 7 Days</option>
                                <option value="30d">Last 30 Days</option>
                                <option value="90d">Last 90 Days</option>
                                <option value="1y">Last Year</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="riskTrendsChart"></canvas>
                    </div>
                </div>

                <!-- High Risk Papers Table -->
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">High Risk Papers Requiring Attention</h3>
                        <div class="table-search">
                            <select class="chart-select" id="highRiskFilter">
                                <option value="all">All High Risk</option>
                                <option value="critical">Critical Only</option>
                                <option value="unreviewed">Unreviewed</option>
                                <option value="recent">Recent (7 days)</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="highRiskPapersTable">
                            <thead>
                                <tr>
                                    <th>Paper Title</th>
                                    <th>Risk Score</th>
                                    <th>Primary Concerns</th>
                                    <th>Upload Date</th>
                                    <th>Priority</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="highRiskPapersBody">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- System Health Section -->
            <section id="system-section" class="dashboard-section" style="display: none;">
                <h2 style="margin-bottom: 30px; color: var(--dark-color);">
                    <i class="fas fa-cogs"></i> System Health & Performance
                </h2>

                <!-- System Status Overview -->
                <div class="health-indicators">
                    <div class="health-indicator">
                        <div class="health-status healthy" id="databaseStatus"></div>
                        <div class="health-label">Database</div>
                    </div>
                    <div class="health-indicator">
                        <div class="health-status healthy" id="apiStatus"></div>
                        <div class="health-label">API Services</div>
                    </div>
                    <div class="health-indicator">
                        <div class="health-status healthy" id="mlModelsStatus"></div>
                        <div class="health-label">ML Models</div>
                    </div>
                    <div class="health-indicator">
                        <div class="health-status healthy" id="storageStatus"></div>
                        <div class="health-label">Storage</div>
                    </div>
                    <div class="health-indicator">
                        <div class="health-status healthy" id="networkStatus"></div>
                        <div class="health-label">Network</div>
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="dashboard-grid">
                    <div class="metric-card info">
                        <div class="metric-header">
                            <div class="metric-title">System Uptime</div>
                            <i class="fas fa-server metric-icon info"></i>
                        </div>
                        <div class="metric-value" id="systemUptime">99.9%</div>
                        <div class="metric-change positive">
                            <i class="fas fa-arrow-up"></i>
                            30 days uptime
                        </div>
                    </div>

                    <div class="metric-card success">
                        <div class="metric-header">
                            <div class="metric-title">Response Time</div>
                            <i class="fas fa-tachometer-alt metric-icon success"></i>
                        </div>
                        <div class="metric-value" id="responseTime">--ms</div>
                        <div class="metric-change positive">
                            <span id="responseTimeChange">Optimal performance</span>
                        </div>
                    </div>

                    <div class="metric-card warning">
                        <div class="metric-header">
                            <div class="metric-title">Memory Usage</div>
                            <i class="fas fa-memory metric-icon warning"></i>
                        </div>
                        <div class="metric-value" id="memoryUsage">--%</div>
                        <div class="metric-change neutral">
                            <span id="memoryDetails">Normal levels</span>
                        </div>
                    </div>

                    <div class="metric-card primary">
                        <div class="metric-header">
                            <div class="metric-title">Queue Length</div>
                            <i class="fas fa-list metric-icon primary"></i>
                        </div>
                        <div class="metric-value" id="queueLength">--</div>
                        <div class="metric-change neutral">
                            <span id="queueStatus">Processing normally</span>
                        </div>
                    </div>
                </div>

                <!-- System Performance Charts -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px;">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">System Load</h3>
                        </div>
                        <div class="chart-container small">
                            <canvas id="systemLoadChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Response Times</h3>
                        </div>
                        <div class="chart-container small">
                            <canvas id="responseTimesChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- System Logs -->
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Recent System Events</h3>
                        <div class="table-search">
                            <select class="chart-select" id="logLevelFilter">
                                <option value="all">All Levels</option>
                                <option value="error">Errors</option>
                                <option value="warning">Warnings</option>
                                <option value="info">Info</option>
                            </select>
                            <button class="btn btn-outline btn-sm" onclick="refreshSystemLogs()">
                                <i class="fas fa-refresh"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="systemLogsTable">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Level</th>
                                    <th>Component</th>
                                    <th>Message</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody id="systemLogsBody">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports-section" class="dashboard-section" style="display: none;">
                <h2 style="margin-bottom: 30px; color: var(--dark-color);">
                    <i class="fas fa-file-download"></i> Reports & Export
                </h2>

                <!-- Report Generation -->
                <div class="chart-card" style="margin-bottom: 30px;">
                    <div class="chart-header">
                        <h3 class="chart-title">Generate Custom Report</h3>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark-color);">Report Type</label>
                            <select class="chart-select" id="reportType" style="width: 100%;">
                                <option value="summary">Executive Summary</option>
                                <option value="detailed">Detailed Analysis</option>
                                <option value="trends">Trend Analysis</option>
                                <option value="risks">Risk Assessment</option>
                                <option value="performance">Performance Report</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark-color);">Date Range</label>
                            <select class="chart-select" id="reportDateRange" style="width: 100%;">
                                <option value="7d">Last 7 Days</option>
                                <option value="30d">Last 30 Days</option>
                                <option value="90d">Last 90 Days</option>
                                <option value="1y">Last Year</option>
                                <option value="all">All Time</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark-color);">Format</label>
                            <select class="chart-select" id="reportFormat" style="width: 100%;">
                                <option value="pdf">PDF Report</option>
                                <option value="excel">Excel Spreadsheet</option>
                                <option value="json">JSON Data</option>
                                <option value="csv">CSV Data</option>
                            </select>
                        </div>
                        
                        <div style="display: flex; align-items: end;">
                            <button class="btn btn-primary" onclick="generateReport()" style="width: 100%;">
                                <i class="fas fa-file-export"></i> Generate Report
                            </button>
                        </div>
                    </div>
                    
                    <div style="background: var(--light-color); padding: 15px; border-radius: var(--border-radius); font-size: 0.9rem; color: #6c757d;">
                        <i class="fas fa-info-circle"></i>
                        Reports include risk analysis summaries, trend data, and system performance metrics. 
                        Large reports may take a few moments to generate.
                    </div>
                </div>

                <!-- Quick Export Options -->
                <div class="dashboard-grid">
                    <div class="metric-card primary" style="cursor: pointer;" onclick="quickExport('current_data')">
                        <div class="metric-header">
                            <div class="metric-title">Current Data</div>
                            <i class="fas fa-download metric-icon primary"></i>
                        </div>
                        <div style="font-size: 1.1rem; color: var(--dark-color); margin: 10px 0;">
                            Export current dashboard data
                        </div>
                        <div style="font-size: 0.8rem; color: #6c757d;">
                            CSV format, ready for analysis
                        </div>
                    </div>

                    <div class="metric-card success" style="cursor: pointer;" onclick="quickExport('all_papers')">
                        <div class="metric-header">
                            <div class="metric-title">All Papers</div>
                            <i class="fas fa-file-csv metric-icon success"></i>
                        </div>
                        <div style="font-size: 1.1rem; color: var(--dark-color); margin: 10px 0;">
                            Complete papers database
                        </div>
                        <div style="font-size: 0.8rem; color: #6c757d;">
                            Full analysis results
                        </div>
                    </div>

                    <div class="metric-card warning" style="cursor: pointer;" onclick="quickExport('high_risk')">
                        <div class="metric-header">
                            <div class="metric-title">High Risk Papers</div>
                            <i class="fas fa-exclamation-triangle metric-icon warning"></i>
                        </div>
                        <div style="font-size: 1.1rem; color: var(--dark-color); margin: 10px 0;">
                            Papers requiring attention
                        </div>
                        <div style="font-size: 0.8rem; color: #6c757d;">
                            Priority review list
                        </div>
                    </div>

                    <div class="metric-card info" style="cursor: pointer;" onclick="quickExport('analytics')">
                        <div class="metric-header">
                            <div class="metric-title">Analytics Data</div>
                            <i class="fas fa-chart-line metric-icon info"></i>
                        </div>
                        <div style="font-size: 1.1rem; color: var(--dark-color); margin: 10px 0;">
                            Performance & trends
                        </div>
                        <div style="font-size: 0.8rem; color: #6c757d;">
                            Statistical summaries
                        </div>
                    </div>
                </div>

                <!-- Report History -->
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Report History</h3>
                        <div class="table-search">
                            <button class="btn btn-outline btn-sm" onclick="clearReportHistory()">
                                <i class="fas fa-trash"></i> Clear History
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="reportHistoryTable">
                            <thead>
                                <tr>
                                    <th>Report Name</th>
                                    <th>Type</th>
                                    <th>Generated</th>
                                    <th>Size</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="reportHistoryBody">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 40px; color: #6c757d;">
                                        <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.3;"></i>
                                        <br>No reports generated yet
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- JavaScript -->
    <script>
        // Global variables
        let currentSection = 'overview';
        let currentPage = 1;
        let papersPerPage = 10;
        let allPapersData = [];
        let dashboardData = {};
        let charts = {};

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            loadDashboardData();
            setupEventListeners();
            setupCharts();
            
            console.log('🚀 Guardian LLM Dashboard initialized');
        });

        // Dashboard initialization
        function initializeDashboard() {
            debugger
            // Setup navigation
            setupNavigation();
            
            // Setup responsive behavior
            handleResponsive();
            
            // Load initial data
            loadInitialData();
        }

        // Navigation setup
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link[data-section]');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const section = this.getAttribute('data-section');
                    showSection(section);
                    
                    // Update active state
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update page title
                    updatePageTitle(section);
                });
            });
        }

        // Show specific section
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.dashboard-section');
            sections.forEach(section => section.style.display = 'none');
            
            // Show selected section
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.style.display = 'block';
                currentSection = sectionName;
                
                // Load section-specific data
                loadSectionData(sectionName);
            }
        }

        // Update page title
        function updatePageTitle(section) {
            const titles = {
                'overview': 'Dashboard Overview',
                'analytics': 'Advanced Analytics',
                'papers': 'Paper Management',
                'risks': 'Risk Analysis',
                'system': 'System Health',
                'reports': 'Reports & Export'
            };
            
            document.getElementById('pageTitle').textContent = titles[section] || 'Dashboard';
        }

        // Load section-specific data
        function loadSectionData(section) {
            switch(section) {
                case 'overview':
                    loadOverviewData();
                    break;
                case 'analytics':
                    loadAnalyticsData();
                    break;
                case 'papers':
                    loadPapersData();
                    break;
                case 'risks':
                    loadRisksData();
                    break;
                case 'system':
                    loadSystemData();
                    break;
                case 'reports':
                    loadReportsData();
                    break;
            }
        }

        // Sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleIcon = document.getElementById('toggleIcon');
            
            sidebar.classList.toggle('collapsed');
            
            if (sidebar.classList.contains('collapsed')) {
                toggleIcon.className = 'fas fa-chevron-right';
            } else {
                toggleIcon.className = 'fas fa-chevron-left';
            }
        }

        // Responsive handling
        function handleResponsive() {
            const mobileToggle = document.querySelector('.mobile-toggle');
            
            if (window.innerWidth <= 1024) {
                mobileToggle.style.display = 'block';
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.add('collapsed');
            }
            
            window.addEventListener('resize', function() {
                if (window.innerWidth <= 1024) {
                    mobileToggle.style.display = 'block';
                } else {
                    mobileToggle.style.display = 'none';
                    document.getElementById('sidebar').classList.remove('open');
                }
            });
        }

        // Data loading functions
        async function loadDashboardData() {
    try {
        showLoadingSkeletons();
        
        const response = await fetch('/api/stats');
        const data = await response.json();
        
        if (response.ok) {
            dashboardData = data;
            updateDashboardMetrics(data);
            updateRiskDistribution(data);
            hideLoadingSkeletons();
        } else {
            console.error('Failed to load dashboard data:', data);
            showErrorState();
        }
    } catch (error) {
        console.error('Dashboard data error:', error);
        showErrorState();
        // Show default values when no data
        document.getElementById('totalPapersMetric').textContent = '0';
        document.getElementById('highRiskMetric').textContent = '0';
        document.getElementById('avgTimeMetric').textContent = 'N/A';
        hideLoadingSkeletons();
    }
}

        async function loadOverviewData() {
            try {
                // Load recent papers
                const papersResponse = await fetch('/api/papers?limit=10&sort=upload_time&order=desc');
                const papersData = await papersResponse.json();
                
                if (papersResponse.ok) {
                    populateRecentPapersTable(papersData.papers || []);
                    updatePapersBadge(papersData.pagination?.total || 0);
                }
                
                // Update trends chart
                updateTrendsChart();
                
            } catch (error) {
                console.error('Overview data error:', error);
            }
        }

        async function loadAnalyticsData() {
            try {
                // Load performance metrics
                updatePerformanceMetrics();
                
                // Update analytics charts
                updateRiskDistributionChart();
                updatePerformanceChart();
                updateCorrelationMatrix();
                updateCategoryAnalyticsTable();
                
            } catch (error) {
                console.error('Analytics data error:', error);
            }
        }

        async function loadPapersData() {
            try {
                const response = await fetch('/api/papers?limit=50');
                const data = await response.json();
                
                if (response.ok) {
                    allPapersData = data.papers || [];
                    populateAllPapersTable(allPapersData);
                    updatePaginationInfo();
                }
            } catch (error) {
                console.error('Papers data error:', error);
            }
        }

        async function loadRisksData() {
            try {
                updateRiskMetrics();
                updateDetailedRiskAnalysis();
                updateRiskTrendsChart();
                loadHighRiskPapers();
            } catch (error) {
                console.error('Risk data error:', error);
            }
        }

        async function loadSystemData() {
            try {
                const response = await fetch('/api/health');
                const healthData = await response.json();
                
                updateSystemHealth(healthData);
                updateSystemMetrics();
                updateSystemCharts();
                loadSystemLogs();
            } catch (error) {
                console.error('System data error:', error);
            }
        }

        function loadReportsData() {
            // Load report history
            loadReportHistory();
        }

        // UI Update Functions
        function updateDashboardMetrics(data) {
            const overview = data.overview || {};
            
            document.getElementById('totalPapersMetric').textContent = overview.total_papers_analyzed || 0;
            document.getElementById('highRiskMetric').textContent = overview.high_risk_papers || 0;
            document.getElementById('avgTimeMetric').textContent = 
                overview.average_processing_time ? `${overview.average_processing_time}s` : '--';
        }

        function updateRiskDistribution(data) {
            const categories = data.category_statistics || {};
            const container = document.getElementById('riskDistribution');
            
            const categoryNames = {
                'bias_fairness': { name: 'Bias & Fairness', icon: 'fas fa-balance-scale' },
                'privacy_data': { name: 'Privacy & Data', icon: 'fas fa-shield-alt' },
                'safety_security': { name: 'Safety & Security', icon: 'fas fa-lock' },
                'dual_use': { name: 'Dual-Use', icon: 'fas fa-exclamation-triangle' },
                'societal_impact': { name: 'Societal Impact', icon: 'fas fa-users' },
                'transparency': { name: 'Transparency', icon: 'fas fa-eye' }
            };
            
            const html = Object.keys(categoryNames).map(key => {
                const category = categoryNames[key];
                const score = categories[key]?.average_score || 0;
                const level = getRiskLevel(score);
                
                return `
                    <div class="risk-category-card">
                        <div class="category-icon">
                            <i class="${category.icon}"></i>
                        </div>
                        <div class="category-name">${category.name}</div>
                        <div class="category-score ${level}">${score}</div>
                        <div class="category-trend">Avg score</div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        function populateRecentPapersTable(papers) {
            const tbody = document.getElementById('recentPapersBody');
            
            if (!papers || papers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #6c757d;">
                            <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.3;"></i>
                            <br>No papers analyzed yet
                        </td>
                    </tr>
                `;
                return;
            }
            
            const html = papers.map(paper => `
                <tr>
                    <td>
                        <div style="font-weight: 500;">${escapeHtml(paper.title.substring(0, 50))}${paper.title.length > 50 ? '...' : ''}</div>
                        <div style="font-size: 0.8rem; color: #6c757d;">ID: ${paper.paper_id}</div>
                    </td>
                    <td>${formatDate(paper.upload_time)}</td>
                    <td>
                        <span style="font-weight: 600; color: ${getRiskColor(paper.overall_risk_score)};">
                            ${paper.overall_risk_score || '--'}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge ${getRiskLevel(paper.overall_risk_score)}">
                            ${getRiskLevel(paper.overall_risk_score)}
                        </span>
                    </td>
                    <td>${paper.processing_time ? `${paper.processing_time}s` : '--'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-outline btn-sm" onclick="viewPaperDetails('${paper.paper_id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="downloadPaperReport('${paper.paper_id}')">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            tbody.innerHTML = html;
        }

        function populateAllPapersTable(papers) {
            const tbody = document.getElementById('allPapersBody');
            
            if (!papers || papers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #6c757d;">
                            No papers found matching current filters
                        </td>
                    </tr>
                `;
                return;
            }
            
            const startIndex = (currentPage - 1) * papersPerPage;
            const endIndex = startIndex + papersPerPage;
            const paginatedPapers = papers.slice(startIndex, endIndex);
            
            const html = paginatedPapers.map(paper => `
                <tr>
                    <td>
                        <div style="font-weight: 500; margin-bottom: 5px;">
                            ${escapeHtml(paper.title.substring(0, 60))}${paper.title.length > 60 ? '...' : ''}
                        </div>
                        <div style="font-size: 0.8rem; color: #6c757d;">
                            ${paper.authors ? JSON.parse(paper.authors).slice(0, 2).join(', ') : 'Unknown'}
                        </div>
                    </td>
                    <td>
                        <div style="font-size: 1.2rem; font-weight: 600; color: ${getRiskColor(paper.overall_risk_score)};">
                            ${paper.overall_risk_score || '--'}
                        </div>
                        <div style="font-size: 0.8rem; color: #6c757d;">Overall</div>
                    </td>
                    <td>
                        <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                            ${generateCategoryBadges(paper.paper_id)}
                        </div>
                    </td>
                    <td>${formatDate(paper.upload_time)}</td>
                    <td>
                        <span class="status-badge ${paper.status || 'completed'}">
                            ${paper.status || 'completed'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-outline btn-sm" onclick="viewPaperDetails('${paper.paper_id}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="downloadPaperReport('${paper.paper_id}')" title="Download Report">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="deletePaper('${paper.paper_id}')" title="Delete Paper">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            tbody.innerHTML = html;
        }

        // Chart setup and updates
        function setupCharts() {
            // Trends Chart
            const trendsCtx = document.getElementById('trendsChart');
            if (trendsCtx) {
                charts.trends = new Chart(trendsCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Papers Analyzed',
                            data: [],
                            borderColor: 'rgb(102, 126, 234)',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            // Risk Distribution Chart
            const riskDistCtx = document.getElementById('riskDistributionChart');
            if (riskDistCtx) {
                charts.riskDistribution = new Chart(riskDistCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Low Risk', 'Medium Risk', 'High Risk', 'Critical Risk'],
                        datasets: [{
                            data: [0, 0, 0, 0],
                            backgroundColor: [
                                'rgb(40, 167, 69)',
                                'rgb(255, 193, 7)',
                                'rgb(253, 126, 20)',
                                'rgb(220, 53, 69)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        function updateTrendsChart() {
            if (!charts.trends) return;
            
            // Generate sample trend data
            const labels = [];
            const data = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString());
                data.push(Math.floor(Math.random() * 20) + 5);
            }
            
            charts.trends.data.labels = labels;
            charts.trends.data.datasets[0].data = data;
            charts.trends.update();
        }

        function updateRiskDistributionChart() {
            if (!charts.riskDistribution) return;
            
            // Use dashboard data if available
            const distribution = dashboardData.risk_distribution || {
                low: 45,
                medium: 30,
                high: 20,
                critical: 5
            };
            
            charts.riskDistribution.data.datasets[0].data = [
                distribution.low,
                distribution.medium,
                distribution.high,
                distribution.critical
            ];
            charts.riskDistribution.update();
        }

        // Utility functions
        function getRiskLevel(score) {
            if (score < 2.5) return 'low';
            if (score < 5.0) return 'medium';
            if (score < 7.5) return 'high';
            return 'critical';
        }

        function getRiskColor(score) {
            const level = getRiskLevel(score);
            const colors = {
                'low': '#28a745',
                'medium': '#ffc107',
                'high': '#fd7e14',
                'critical': '#dc3545'
            };
            return colors[level] || '#6c757d';
        }

        function formatDate(dateString) {
            if (!dateString) return '--';
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function generateCategoryBadges(paperId) {
            // Mock category data - in real implementation, fetch from API
            const categories = ['bias', 'privacy', 'safety'];
            return categories.map(cat => 
                `<span class="status-badge ${cat}" style="font-size: 0.7rem;">${cat}</span>`
            ).join('');
        }

        function showLoadingSkeletons() {
            const skeletons = document.querySelectorAll('.loading-skeleton');
            skeletons.forEach(skeleton => skeleton.style.display = 'block');
        }

        function hideLoadingSkeletons() {
            const skeletons = document.querySelectorAll('.loading-skeleton');
            skeletons.forEach(skeleton => skeleton.style.display = 'none');
        }

        function showErrorState() {
            console.log('Showing error state for failed data load');
        }

        function updatePapersBadge(count) {
            document.getElementById('papersBadge').textContent = count;
        }

        // Event handlers
        function refreshDashboard() {
            loadDashboardData();
            loadSectionData(currentSection);
        }

        function updateTimeRange() {
            const timeRange = document.getElementById('timeRange').value;
            console.log('Time range changed to:', timeRange);
            // Reload data with new time range
            loadDashboardData();
        }

        function viewPaperDetails(paperId) {
            // Open paper details modal or navigate to details page
            window.open(`/paper/${paperId}`, '_blank');
        }

        function downloadPaperReport(paperId) {
            // Download paper report
            window.location.href = `/api/paper/${paperId}/report`;
        }

        function deletePaper(paperId) {
            if (confirm('Are you sure you want to delete this paper? This action cannot be undone.')) {
                fetch(`/api/paper/${paperId}`, { method: 'DELETE' })
                    .then(response => {
                        if (response.ok) {
                            loadPapersData();
                            loadDashboardData();
                        } else {
                            alert('Failed to delete paper');
                        }
                    })
                    .catch(error => {
                        console.error('Delete error:', error);
                        alert('Error deleting paper');
                    });
            }
        }

        function applyPapersFilter() {
            const riskLevel = document.getElementById('riskLevelFilter').value;
            const dateRange = document.getElementById('dateRangeFilter').value;
            const sortBy = document.getElementById('sortFilter').value;
            
            // Apply filters to allPapersData
            let filteredPapers = [...allPapersData];
            
            // Risk level filter
            if (riskLevel !== 'all') {
                filteredPapers = filteredPapers.filter(paper => {
                    const level = getRiskLevel(paper.overall_risk_score);
                    return level === riskLevel;
                });
            }
            
            // Date range filter
            if (dateRange !== 'all') {
                const now = new Date();
                let cutoffDate;
                
                switch(dateRange) {
                    case 'today':
                        cutoffDate = new Date(now.setHours(0, 0, 0, 0));
                        break;
                    case 'week':
                        cutoffDate = new Date(now.setDate(now.getDate() - 7));
                        break;
                    case 'month':
                        cutoffDate = new Date(now.setMonth(now.getMonth() - 1));
                        break;
                    case 'quarter':
                        cutoffDate = new Date(now.setMonth(now.getMonth() - 3));
                        break;
                }
                
                if (cutoffDate) {
                    filteredPapers = filteredPapers.filter(paper => 
                        new Date(paper.upload_time) >= cutoffDate
                    );
                }
            }
            
            // Sort papers
            filteredPapers.sort((a, b) => {
                switch(sortBy) {
                    case 'date_desc':
                        return new Date(b.upload_time) - new Date(a.upload_time);
                    case 'date_asc':
                        return new Date(a.upload_time) - new Date(b.upload_time);
                    case 'risk_desc':
                        return (b.overall_risk_score || 0) - (a.overall_risk_score || 0);
                    case 'risk_asc':
                        return (a.overall_risk_score || 0) - (b.overall_risk_score || 0);
                    case 'title_asc':
                        return a.title.localeCompare(b.title);
                    default:
                        return 0;
                }
            });
            
            populateAllPapersTable(filteredPapers);
            updatePaginationInfo(filteredPapers.length);
        }

        function searchPapers() {
            const searchTerm = document.getElementById('papersSearchInput').value.toLowerCase();
            
            if (!searchTerm) {
                populateAllPapersTable(allPapersData);
                return;
            }
            
            const filteredPapers = allPapersData.filter(paper => 
                paper.title.toLowerCase().includes(searchTerm) ||
                (paper.authors && paper.authors.toLowerCase().includes(searchTerm)) ||
                (paper.abstract && paper.abstract.toLowerCase().includes(searchTerm))
            );
            
            populateAllPapersTable(filteredPapers);
            updatePaginationInfo(filteredPapers.length);
        }

        function changePage(direction) {
            const newPage = currentPage + direction;
            const maxPage = Math.ceil(allPapersData.length / papersPerPage);
            
            if (newPage >= 1 && newPage <= maxPage) {
                currentPage = newPage;
                populateAllPapersTable(allPapersData);
                updatePaginationInfo();
            }
        }

        function updatePaginationInfo(totalCount = null) {
            const total = totalCount !== null ? totalCount : allPapersData.length;
            const start = (currentPage - 1) * papersPerPage + 1;
            const end = Math.min(currentPage * papersPerPage, total);
            const maxPage = Math.ceil(total / papersPerPage);
            
            document.getElementById('paginationInfo').textContent = 
                `Showing ${start}-${end} of ${total} papers`;
            
            document.getElementById('prevPageBtn').disabled = currentPage <= 1;
            document.getElementById('nextPageBtn').disabled = currentPage >= maxPage;
        }

        // Analytics functions (placeholders)
        function updatePerformanceMetrics() {
            document.getElementById('peakAnalysisTime').textContent = '45.3s';
            document.getElementById('commonRiskType').textContent = 'Privacy';
            document.getElementById('successRate').textContent = '99.7%';
            document.getElementById('avgConfidence').textContent = '94.2%';
        }

        function updatePerformanceChart() {
            // Implementation for performance chart
        }

        function updateCorrelationMatrix() {
            // Implementation for correlation matrix
        }

        function updateCategoryAnalyticsTable() {
            // Implementation for category analytics table
        }

        // Risk analysis functions
        function updateRiskMetrics() {
            document.getElementById('criticalRisksCount').textContent = '3';
            document.getElementById('highRisksCount').textContent = '12';
            document.getElementById('frequentRiskType').textContent = 'Privacy Data';
            document.getElementById('lowRisksCount').textContent = '156';
        }

        function updateDetailedRiskAnalysis() {
            // Implementation for detailed risk analysis
        }

        function updateRiskTrendsChart() {
            // Implementation for risk trends chart
        }

        function loadHighRiskPapers() {
            // Implementation for high risk papers table
        }

        // System health functions
        function updateSystemHealth(healthData) {
            const components = healthData.components || {};
            
            Object.keys(components).forEach(component => {
                const element = document.getElementById(component + 'Status');
                if (element) {
                    element.className = `health-status ${components[component] ? 'healthy' : 'error'}`;
                }
            });
        }

        function updateSystemMetrics() {
            document.getElementById('responseTime').textContent = '245ms';
            document.getElementById('memoryUsage').textContent = '67%';
            document.getElementById('queueLength').textContent = '0';
        }

        function updateSystemCharts() {
            // Implementation for system charts
        }

        function loadSystemLogs() {
            // Implementation for system logs
        }

        function refreshSystemLogs() {
            loadSystemLogs();
        }

        // Reports functions
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const dateRange = document.getElementById('reportDateRange').value;
            const format = document.getElementById('reportFormat').value;
            
            console.log('Generating report:', { reportType, dateRange, format });
            
            // Simulate report generation
            alert(`Generating ${reportType} report in ${format} format for ${dateRange}...`);
        }

        function quickExport(exportType) {
            console.log('Quick export:', exportType);
            
            // Simulate export
            const filename = `guardian_llm_${exportType}_${new Date().toISOString().split('T')[0]}.csv`;
            alert(`Exporting ${exportType} data as ${filename}...`);
        }

        function loadReportHistory() {
            // Implementation for report history
        }

        function clearReportHistory() {
            if (confirm('Are you sure you want to clear all report history?')) {
                // Implementation for clearing report history
                loadReportHistory();
            }
        }

        function exportHeatmapData() {
            // Implementation for exporting heatmap data
        }

        function exportPapersData() {
            // Implementation for exporting papers data
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search functionality
            document.getElementById('paperSearch').addEventListener('input', function() {
                // Debounced search implementation
                clearTimeout(this.searchTimeout);
                this.searchTimeout = setTimeout(() => {
                    // Implement search functionality
                }, 300);
            });
            
            // Time range changes
            document.getElementById('timeRange').addEventListener('change', updateTimeRange);
            
            // Chart control changes
            const chartControls = document.querySelectorAll('.chart-select');
            chartControls.forEach(control => {
                control.addEventListener('change', function() {
                    // Update corresponding chart based on control
                    console.log('Chart control changed:', this.id, this.value);
                });
            });
        }

        function loadInitialData() {
            // Load any initial data that doesn't require API calls
            console.log('Loading initial dashboard data...');
        }

        // Export dashboard functions for global access
        window.GuardianDashboard = {
            showSection,
            refreshDashboard,
            updateTimeRange,
            viewPaperDetails,
            downloadPaperReport,
            deletePaper,
            generateReport,
            quickExport
        };

        console.log('✅ Guardian LLM Dashboard fully loaded!');
    </script>
</body>
</html>
